{% extends "base.html" %}

{% block content %}
<div class="container-fluid">

  <!-- Encabezado -->
  <div class="d-sm-flex align-items-center justify-content-between mb-4">
    <h1 class="h3 mb-0 text-gray-800">Resumen de Ventas</h1>
    <div class="form-inline">
      <label class="mr-2">Periodo:</label>
      <select class="form-control" id="filtro-selector" onchange="cambiarFiltro()">
        <option value="semana" {% if filtro == 'semana' %}selected{% endif %}>Semana</option>
        <option value="quincena" {% if filtro == 'quincena' %}selected{% endif %}>Quincena</option>
        <option value="mes" {% if filtro == 'mes' %}selected{% endif %}>Mes</option>
      </select>
    </div>
  </div>

  <!-- Card con grÃ¡fico -->
  <div class="card shadow mb-4">
    <div class="card-header py-3">
      <h6 class="m-0 font-weight-bold text-primary">Ventas Diarias</h6>
    </div>
    <div class="card-body">
      <div class="chart-area">
        <canvas id="ventasChart"></canvas>
      </div>
    </div>
  </div>

</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById("ventasChart").getContext("2d");
  const chart = new Chart(ctx, {
    type: "line",
    data: {
      labels: [
        {% for fecha, cant in zip(fechas, cantidades) %}
          "{{ fecha }} ({{ cant }} op.)"{% if not loop.last %},{% endif %}
        {% endfor %}
      ],
      datasets: [{
        label: "Ventas ($)",
        data: {{ totales | tojson }},
        fill: true,
        tension: 0.4,
        borderColor: "#4e73df",
        backgroundColor: "rgba(78, 115, 223, 0.05)",
        pointBackgroundColor: "#4e73df",
        pointBorderColor: "#4e73df"
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });

  function cambiarFiltro() {
    const filtro = document.getElementById("filtro-selector").value;
    const url = new URL(window.location.href);
    url.searchParams.set('filtro', filtro);
    window.location.href = url.toString();
  }
</script>
{% endblock %}

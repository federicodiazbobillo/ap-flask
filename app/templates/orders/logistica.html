{% extends "base.html" %}

{% block content %}

<!-- Reducir tama√±o de fuente para la vista de Log√≠stica -->
<div class="small">

  <div class="d-flex justify-content-between align-items-center mb-3">
      <h2>Log√≠stica</h2>
      <div class="input-group mb-3" style="max-width: 400px;">
          <input type="number" class="form-control" id="input-order-id-busqueda" placeholder="ID de orden o pack">
          <button class="btn btn-outline-info" type="button" id="btn-buscar-id">üîç Buscar orden</button>
      </div>
      <div>
          <button class="btn btn-outline-secondary btn-sm me-2" id="btn-limpiar-filtros">üßπ Limpiar filtros</button>
          <a href="#" class="btn btn-outline-primary btn-sm me-2" id="btn-sincronizar-todo">üîÅ Todo</a>
          <a href="#" class="btn btn-outline-success btn-sm me-2" id="btn-sincronizar-mes">üìÖ √öltimo mes</a>
          <a href="#" class="btn btn-outline-warning btn-sm" id="btn-sincronizar-48h">‚è±Ô∏è √öltimas 48h</a>
      </div>
  </div>

  <!-- Mensaje √©xito -->
  <div id="mensaje-exito" class="card bg-success text-white shadow mb-4" style="display: none;">
      <div class="card-body py-2">‚úÖ Sincronizaci√≥n exitosa</div>
  </div>

  <!-- Modal de carga -->
  <div class="modal fade" id="modalCargando" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-sm modal-dialog-centered">
      <div class="modal-content text-center p-3">
        <div class="spinner-border text-primary mb-2" role="status"></div>
        <div><strong>Sincronizando √≥rdenes...</strong></div>
      </div>
    </div>
  </div>

  <!-- Tabla de √≥rdenes -->
  <div class="table-responsive">
      <table class="table table-sm table-bordered table-striped table-hover nowrap w-100" id="tabla-ordenes">
          <thead class="thead-dark">
              <tr>
                  <th>ID Orden</th>
                  <th>Fecha</th>
                  <th>Total</th>
                  <th>Estado</th>
                  <th>Env√≠o</th>
                  <th>Items</th>
              </tr>
          </thead>
          <tbody>
              {% for order in ordenes %}
              <tr>
                  <td>{{ order.order_id }}</td>
                  <td>{{ order.created_at.strftime('%Y-%m-%d %H:%M') if order.created_at }}</td>
                  <td>${{ '%.2f'|format(order.total_amount or 0) }}</td>
                  <td>{{ order.status }}</td>
                  <td>
                      {% if order.shipping %}
                          ${{ '%.2f'|format(order.shipping.list_cost or 0) }}
                      {% else %}
                          -
                      {% endif %}
                  </td>
                  <td>
                      {% if order.items %}
                      <table class="table table-sm table-bordered mb-0">
                          <thead class="bg-light">
                              <tr>
                                  <th>ID</th>
                                  <th>SKU</th>
                                  <th>Cant.</th>
                                  <th>D√≠as Fab.</th>
                                  <th>Comisi√≥n</th>
                              </tr>
                          </thead>
                          <tbody>
                              {% for item in order.items %}
                              <tr>
                                  <td>{{ item.item_id }}</td>
                                  <td>{{ item.seller_sku or '-' }}</td>
                                  <td>{{ item.quantity }}</td>
                                  <td>{{ item.manufacturing_days or 0 }}</td>
                                  <td>${{ '%.2f'|format(item.sale_fee or 0) }}</td>
                              </tr>
                              {% endfor %}
                          </tbody>
                      </table>
                      {% else %}
                          -
                      {% endif %}
                  </td>
              </tr>
              {% endfor %}
          </tbody>
      </table>
  </div>

</div>

<script src="{{ url_for('static', filename='js/filtros_aplicados/logistica_filtros.js') }}"></script>

{% endblock %}
